# Heroku
## Hands on Session



## 想定する受講者
- 現在JavaでWebアプリケーション開発をしている人
- Heroku/AWS未経験



## 目標
- Herokuを使ってスケーラブルなアプリ開発ができるようなる
- 開発中にぶつかるであろう疑問点を解消できる
- オンプレ環境とHeroku環境の違いを理解する



## Herokuの特徴
- ### Stateless
 状態を持たないアプリケーションサーバ
 
- ### Immutable Infrastructure 
 アプリケーションは廃棄する




## The Twelve Factor App

Software as a Serviceを作り上げるための方法論

* セットアップ自動化のために 宣言的な フォーマットを使い、プロジェクトに新しく加わった開発者が要する時間とコストを最小化する。
* 下層のOSへの 依存関係を明確化 し、実行環境間での 移植性を最大化 する。
* モダンな クラウドプラットフォーム 上への デプロイ に適しており、サーバー管理やシステム管理を不要なものにする。
* 開発環境と本番環境の 差異を最小限 にし、アジリティを最大化する 継続的デプロイ を可能にする。
* ツール、アーキテクチャ、開発プラクティスを大幅に変更することなく スケールアップ できる。



### The Twelve Factors

- I. コードベース (Codebase)
- II. 依存関係 (Dependencies)
- III. 設定 (Config)
- IV. バックエンドサービス (Backing Services)
- V. ビルド、リリース、実行 (Build, release, run)
- VI. プロセス (Processes)
- VII. ポートバインディング (Port binding)
- VIII. 並行性 (Concurrency)
- IX. 廃棄容易性 (Disposability)
- X. 開発/本番一致 (Dev/prod parity)
- XI. ログ (Logs)
- XII. 管理プロセス (Admin processes)  

詳しくは[http://twelve-factor-ja.herokuapp.com/]を参照



## サンプルアプリの想定
- キャンペーンサイト
- 期間は限定的であるが、利用者数が予想できない
- 写真をアップロードして応募
![sample app](https://cacoo.com/diagrams/GlcQ0gDjJDbePDc6-FBFC9.png)



## 学習のSTEP
- STEP-1 : Hello World
- STEP-2: キャンペーン応募情報をDBに登録しよう！ 
- STEP-3: 応募写真のアップロード機能を作りましょう
- STEP-3: 応募完了メールを送信しましょう
- STEP-7: 夜間バッチで当選メール送信(バッチ/cronの代わり)
- STEP-6: 複数環境でデプロイ＆リリースしよう
- STEP-8: 運用しよう(バックアップ、ログ監視)
- STEP-9: 本番に対応して安心したサイトを(DNS, SSL)




## STEP-1
### Hello World
![Step1](https://cacoo.com/diagrams/GlcQ0gDjJDbePDc6-BFEFB.png)



## STEP-2
### ユーザ機能を作りましょう



## STEP-3
### 登録メールを送信しましょう



## STEP-4
### 写真をアップできるようにしましょう



## STEP-5
### スケールアウトできるように冗長化させよう！



## STEP-6
### 複数環境でデプロイ＆リリースしよう



## STEP-7
### 夜間バッチでメール送信



## STEP-8
### 運用しよう(バックアップ、ログ監視)



## STEP-9
### 本番に対応して安心したサイトを(DNS, SSL)



- 第5章的なものでHerokuアプリのベストプラクティス的な設計を
講習するためのストーリー（サンプルアプリケーション）があるといい。（重いので・・・）

想定アプリ、デザインはBootStrapなどでいいと思う(日産的なケースなど)
スケジューラの話

例）
- ステップ1:Hello World
- ステップ2:ユーザ登録
→　DBなどの話
- ステップ3: メール送信、会員登録後のメール送信ってしますよね？
- ステップ4: プロフィール写真をアップできるようにしましょう(S3 Directupload)
- ステップ6: 夜間バッチでメール送信(バッチ/cronの代わり)
- ステップ7: スケールさせる、冗長化させよう！
     ステップ7-1. Session管理
- ステップ8: 本番に対応して安心したサイトを(DNS, SSL)
- ステップ9: 複数環境でデプロイ＆リリースしよう
環境変数は分けましょうね

###- ステップ8: 大量のデータを分析したい：TreasureData

運用しよう
- ログの監視 PT
- Metricsの監視 NewReric
- バックアップ/pgbackup

2.  技術支援についてまとめる

　　　(1) 本番・ステージング・テスト・開発
　　　(2) アドオンの選定ならびに設定
　　　(3) デプロイ手順の検討
　　　(4) システムとデータのバックアップ
　　　(5) リカバリ手順

　　　(1) 本番・ステージング・テスト・開発, (2) アドオンの選定ならびに設定, (3) デプロイ手順の検討, (4) システムとデータのバックアップ, (5) リカバリ手順

　　　　Java/.NETでWebアプリケーション開発をしている人、Heroku/AWS未経験の人に

　　　　- トレーニング資料を同じものを見せる

　　　　- 半日のトレーニングをします
　　　　- プロジェクトの要件を聞いてAdd-onなどの構成を提案します
　　　　- オンサイト含むサポート 0.5からはまって、、、xxx万円

